# Лабораторная работа №2

## 1. Тема: Табло победителей автогонок


## 2. Реализованный функционал

### 2.1 Регистрация новых пользователей

Реализована регистрация пользователей через форму `UserRegisterForm`, основанную на стандартной `UserCreationForm`.

**Реализация:**

* Представление: `UserRegisterView` (`CreateView`) в `views.py`
* Форма: `UserRegisterForm` в `forms.py`
* Шаблон: `register.html`
* URL: `/register/`

**Поля формы:**

* `username`
* `first_name`
* `last_name`
* `password1`
* `password2`


### 2.2 Авторизация пользователей

Реализована форма входа с использованием стандартного механизма Django.

**Реализация:**

* Представление: `UserLoginView` (`LoginView`) в `views.py`
* Форма: `AuthenticationForm`
* Шаблон: `login.html`
* URL: `/login/`


### 2.3 Просмотр автогонок

Реализован просмотр списка гонок с пагинацией и поиском.

**Реализация:**

* Представление: `RaceListView` (`ListView`) в `views.py`
* Шаблон: `race_list.html`
* URL: `/races/`

**Функции списка гонок:**

* Пагинация по 5 гонок на страницу (`paginate_by = 5`)
* Поиск по параметру `q`:

  * по названию гонки (`name`)
  * по месту (`location`)
  * по дате (`date`)

**Поиск реализован через Django ORM:**

* `Q(name__icontains=q)`
* `Q(location__icontains=q)`
* `Q(date__icontains=q)`


### 2.4 Создание и удаление гонок (для администратора)

Администратор (superuser) может добавлять и удалять гонки.

**Создание гонки:**

* Представление: `RaceCreateView` (`CreateView`)
* Форма: `RaceForm`
* Шаблон: `race_form.html`
* URL: `/race/create/`

**Удаление гонки:**

* Представление: `RaceDeleteView` (`DeleteView`)
* URL: `/race/<int:pk>/delete/`

**Кнопки добавления/удаления отображаются только для суперпользователя**

```
    {% if user.is_superuser %}
```


### 2.5 Просмотр конкретной гонки и регистрация гонщиков

Реализована детальная страница гонки, где отображается:

* информация о гонке (название, дата, место, статус)
* таблица результатов (время заезда + победитель)
* список участников (ФИО, команда, автомобиль, опыт, класс)
* форма регистрации участника (если доступна)
* комментарии и форма комментариев

**Реализация:**

* Представление: `RaceDetailView` (`TemplateView`)
* Шаблон: `race_detail.html`
* URL: `/race/<int:pk>/`


### 2.6 Редактирование и удаление регистраций гонщиков

Пользователь может редактировать и удалять только свои регистрации.

#### Удаление регистрации

Реализовано через `RacerDeleteView`.

* если пользователь `superuser`, то он может удалить любую регистрацию

**URL:**

* `/racer/<int:pk>/delete/`


#### Редактирование регистрации

Реализовано через `RacerUpdateView`.


* если пользователь `superuser`, может редактировать любую регистрацию, иначе редактируется только регистрация текущего пользователя
* после сохранения выполняется возврат на страницу гонки

**Реализация:**

* Представление: `RacerUpdateView` (`UpdateView`)
* Форма: `RacerUpdateForm`
* Шаблон: `racer_update.html`
* URL: `/racer/<int:pk>/update/`


### 2.7 Комментарии и отзывы к автогонкам

Реализовано добавление комментариев к гонке, доступное только авторизованным пользователям.

Сохраняется:

* текст комментария (`comment`)
* тип комментария (`comment_type`)
* рейтинг (`rating`, 1–10)
* пользователь (`user`)
* гонка (`race`)

**Реализация:**

* Модель: `Comments`
* Форма: `commentForm`
* Обработка выполняется в `RaceDetailView.post()` при наличии `send_comment` в `POST`

**Типы комментариев:**

* сотрудничество
* гонки
* иное

**Рейтинг:**

* выбор от 1 до 10 (выпадающий список)

* реализована защита от дублирования комментариев (одинаковый текст от одного пользователя к одной гонке)


### 2.8 Пагинация комментариев

Комментарии выводятся постранично по 5 на страницу.

**Реализация:**

* `Paginator(comments, 5)`
* обработка `PageNotAnInteger`, `EmptyPage`

Отображение страниц реализовано в шаблоне `race_detail.html`.


### 2.9 Таблица результатов гонки (клиентская часть)

В клиентской части реализована таблица результатов на странице гонки:

**Колонки:**

* Время заезда
* Победитель

Данные берутся из:

```
    Results.objects.filter(race=race)
```


## 3. Модели данных

### 3.1 User

Кастомная модель пользователя.

**Файл:** `models.py`
**Наследование:** `AbstractUser`


### 3.2 Race (Автогонка)

**Поля:**

* `name` - название
* `date` - дата/время гонки (`DateTimeField`)
* `location` - место проведения
* `has_occurred` - флаг завершения гонки

### 3.3 Racer (Участник гонки)

Хранит информацию об участнике гонки.

**Поля:**

* `user` - пользователь
* `race` - гонка (`related_name="racers"`)
* `full_name` - ФИО
* `team_name` - команда
* `car_description` - описание автомобиля
* `experience` - опыт
* `racer_class` - класс участника

**Ограничение:**

```
    unique_together = ('user', 'race')
```

Один пользователь может зарегистрироваться на гонку только один раз.


### 3.4 Results (Результаты)

Хранит результаты гонки и победителя.

**Поля:**

* `race` - гонка (`related_name="results"`)
* `race_time` - время заезда (`DurationField`)
* `winner` - победитель (ForeignKey на `Racer`)

**Особенность:**
При сохранении результата гонка автоматически помечается как прошедшая:

```
    if not self.race.has_occurred:
        self.race.has_occurred = True
```


### 3.5 Comments (Комментарии)

Хранит комментарии к гонкам.

**Поля:**

* `user`
* `race` (`related_name="comments"`)
* `comment`
* `comment_type`
* `rating`



## 4. Формы

### 4.1 UserRegisterForm

Форма регистрации пользователя (на базе `UserCreationForm`).



### 4.2 RaceForm

Форма создания гонки.

Поля:

* `name`
* `date`
* `location`
* `has_occurred`



### 4.3 RacerCreateForm / RacerUpdateForm

Формы создания и редактирования участника гонки.

Поля:

* `full_name`
* `team_name`
* `car_description`
* `experience`
* `racer_class`



### 4.4 commentForm

Форма комментария к гонке.

Поля:

* `comment` (Textarea)
* `rating` (1-10)
* `comment_type` (выбор типа)



## 5. Маршрутизация (URLs)

Основные маршруты:

* `/` - перенаправление (`hello_function`)
* `/Hello/` - приветственная страница
* `/login/` - вход
* `/register/` - регистрация
* `/races/` - список гонок
* `/race/create/` - создание гонки
* `/race/<pk>/` - страница гонки
* `/race/<pk>/delete/` - удаление гонки
* `/racer/<pk>/update/` - редактирование регистрации
* `/racer/<pk>/delete/` - удаление регистрации


## 6. Админ-панель Django

Реализована регистрация моделей в `admin.py`.

Зарегистрированы:

* `Race`
* `Racer`
* `User`
* `Results`
* `Comments`

Это позволяет администратору управлять гонками, участниками, результатами и комментариями через стандартную панель `/admin/`.


## 7. Клиентская часть (templates)

Используется Bootstrap для оформления интерфейса.

Основные шаблоны:

* `hello.html` - стартовая страница
* `login.html` - вход
* `register.html` - регистрация
* `race_list.html` - список гонок + поиск + пагинация
* `race_detail.html` - гонка + участники + результаты + комментарии
* `race_form.html` - добавление гонки
* `racer_update.html` - редактирование регистрации

