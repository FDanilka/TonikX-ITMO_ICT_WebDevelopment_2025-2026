<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>{{ race.name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>{{ race.name }}</h1>
        <p><strong>Дата:</strong> {{ race.date }}</p>
        <p><strong>Место проведения:</strong> {{ race.location }}</p>
        <p><strong>Статус:</strong> {% if race.has_occurred %}Прошла{% else %}Не состоялась{% endif %}</p>

        <table class="table table-striped">
        <thead>
            <tr>
                <th>Время заезда</th>
                <th>Победитель</th>
            </tr>
        </thead>
        <tbody>
            {% for result in race_results %}
                <tr>
                    <td>{{ result.race_time }}</td>
                    <td>{{ result.winner.full_name }}</td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="2">Не завершилась</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>

        <h2>Участники гонки</h2>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ФИО</th>
                    <th>Команда</th>
                    <th>Описание автомобиля</th>
                    <th>Опыт</th>
                    <th>Класс гонщика</th>
                    {% if user.is_authenticated %}
                    <th>Действия</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% for racer in racers %}
                    <tr>
                        <td>{{ racer.full_name }}</td>
                        <td>{{ racer.team_name }}</td>
                        <td>{{ racer.car_description }}</td>
                        <td>{{ racer.experience }} лет</td>
                        <td>{{ racer.racer_class }}</td>
                        {% if user.is_authenticated %}
                        <td>
                            {% if racer.user == user or user.is_superuser %}
                                {% if not racer.race.has_occurred %}
                                <a href="{% url 'racer_update' racer.pk %}" class="btn btn-sm btn-primary">Редактировать</a>
                                <form method="POST" action="{% url 'racer_delete' racer.pk %}" style="display: inline;">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Вы уверены, что хотите удалить эту регистрацию?')">Удалить</button>
                                </form>
                                {% endif %}
                            {% endif %}
                        </td>
                        {% endif %}
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="{% if user.is_authenticated %}6{% else %}5{% endif %}" class="text-center">Нет участников для этой гонки.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        {% if racer_form %}
            <h3>Зарегистрироваться как участник</h3>
            <form method="POST">
                {% csrf_token %}
                {{ racer_form.as_p }}
                <button type="submit" name="register" class="btn btn-primary">Зарегистрироваться</button>
            </form>
        {% elif user_is_registered %}
            <p>Вы уже зарегистрированы на эту гонку.</p>
        {% elif race_has_occurred %}
            <p>Гонка уже прошла, регистрация закрыта.</p>
        {% endif %}
        <div>
            <a href="{% url 'race_list' %}" class="btn btn-secondary mt-3">Назад</a>
        </div>
    </div>
    <div class="container mt-3">
        <h1>Оставить комментарий</h1>
            <form method="POST">
                {% csrf_token %}
                {{ comment_form.as_p }}
                <button type="submit" name="send_comment" class="btn btn-primary">Отправить</button>
            </form>
    </div>>
    <div class="list-group">
            {% for comment in comments %}
                <div class="list-group-item">
                    <h5>{{ comment.user.username }}</h5>
                    <p><strong>Комментарий:</strong> {{ comment.comment }}</p>
                    <p><strong>Тип:</strong> {{ comment.comment_type }}</p>
                    <p><strong>Оценка:</strong> {{ comment.rating }}</p>

                </div>
            {% empty %}
                <p>Комментариев пока нет.</p>
            {% endfor %}
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<div class="d-flex justify-content-center mt-4">
    <nav aria-label="Page navigation">
        <ul class="pagination pagination-lg">
            {% if comments.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ comments.previous_page_number }}" aria-label="Previous">&laquo;</a>
                </li>
            {% endif %}

            <li class="page-item disabled">
                <span class="page-link">{{ comments.number }} / {{ comments.paginator.num_pages }}</span>
            </li>

            {% if comments.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ comments.next_page_number }}" aria-label="Next">&raquo;</a>
                </li>
            {% endif %}
        </ul>
    </nav>
</div>


</body>
</html>
